<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯è¯­æ¶ˆæ¶ˆä¹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4, #fad0c4, #a1c4fd);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #5a3e36;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.8);
            background: linear-gradient(to right, #ff6b6b, #ffa36c, #ffd166, #06d6a0, #118ab2, #7209b7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }

        h1::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 10%;
            width: 80%;
            height: 10px;
            background: linear-gradient(to right, #ff6b6b, #ffd166, #06d6a0, #118ab2);
            border-radius: 5px;
            opacity: 0.7;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.7);
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border: 3px dashed #ff9a9e;
        }

        .timer, .score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #5a3e36;
            text-shadow: 1px 1px 0 white;
        }

        .game-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 25px;
            border-radius: 25px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 800px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 4px solid #ffd166;
        }

        .upload-section h3 {
            margin-bottom: 15px;
            color: #ff6b6b;
            font-size: 1.8rem;
            text-shadow: 1px 1px 0 white;
        }

        .upload-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .upload-btn {
            background: linear-gradient(to bottom, #ff9a9e, #fad0c4);
            color: #5a3e36;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 0 #e76f51;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #e76f51;
        }

        .upload-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #e76f51;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 900px;
            margin-top: 20px;
        }

        .card {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            overflow: hidden;
            position: relative;
            border: 4px solid #ffd166;
        }

        .card:hover {
            transform: translateY(-8px) rotate(2deg);
            box-shadow: 0 15px 20px rgba(0, 0, 0, 0.2);
        }

        .card.selected {
            transform: scale(1.08);
            box-shadow: 0 0 25px #4a9eff;
            border-color: #4a9eff;
        }

        .card.matched {
            animation: disappear 0.5s forwards;
            pointer-events: none;
        }

        .card.wrong {
            animation: shake 0.5s;
        }

        .word-card {
            color: #5a3e36;
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            padding: 10px;
        }

        .image-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: 3px solid white;
            border-radius: 15px;
        }

        .card-label {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.8rem;
            color: #5a3e36;
            background: rgba(255, 255, 255, 0.8);
            padding: 3px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: linear-gradient(to bottom, #a1c4fd, #c2e9fb);
            color: #5a3e36;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: bold;
            margin: 20px 0;
            transition: all 0.3s;
            box-shadow: 0 6px 0 #118ab2;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background: linear-gradient(to bottom, #c2e9fb, #a1c4fd);
            transform: translateY(-4px);
            box-shadow: 0 10px 0 #118ab2;
        }

        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #118ab2;
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 5px 0 #999999;
        }

        /* åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes disappear {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(0); opacity: 0; display: none; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .card {
                width: 120px;
                height: 120px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .game-info {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
        }

        /* æ¸¸æˆç»“æŸå’ŒæˆåŠŸæç¤º */
        .message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            display: none;
        }

        .message-content {
            background: linear-gradient(135deg, #ff9a9e, #fad0c4, #a1c4fd);
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border: 5px solid #ffd166;
            animation: celebrate 0.5s ease-in-out 3;
        }

        .message h2 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            color: #5a3e36;
            text-shadow: 2px 2px 0 white;
        }

        .message p {
            font-size: 1.3rem;
            margin-bottom: 30px;
            color: #5a3e36;
        }

        .uploaded-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            max-height: 150px;
            overflow-y: auto;
        }

        .uploaded-item {
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            border: 2px solid #ff9a9e;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .upload-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .preview-item {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 3px solid #ffd166;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .preview-item .word {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background: white;
            color: #5a3e36;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            opacity: 0.7;
            z-index: -1;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff6b6b;
            top: -10px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âœ¨ è¯è¯­æ¶ˆæ¶ˆä¹ âœ¨</h1>
            <p>åŒ¹é…è¯è¯­ä¸å›¾ç‰‡ï¼ŒæŒ‘æˆ˜ä½ çš„è®°å¿†åŠ›ï¼</p>
        </header>

        <div class="game-info">
            <div class="timer">â±ï¸ æ—¶é—´: <span id="time">00:00</span></div>
            <div class="score">â­ å¾—åˆ†: <span id="points">0</span></div>
        </div>

        <div class="game-area">
            <div class="upload-section">
                <h3>ğŸ“¤ ä¸Šä¼ è¯å¡å’Œå›¾ç‰‡</h3>
                <p>ä¸Šä¼ æ–‡æœ¬æ–‡ä»¶ï¼ˆæ¯è¡Œä¸€ä¸ªè¯ï¼Œæœ€å¤š20ä¸ªï¼‰å’Œå¯¹åº”çš„å›¾ç‰‡ï¼ˆæ¯ä¸ªè¯ä¸€å¼ å›¾ï¼‰</p>
                <div class="upload-controls">
                    <div class="file-input-wrapper">
                        <input type="file" id="excel-upload" accept=".txt">
                        <button class="upload-btn" id="excel-btn">ğŸ“ ä¸Šä¼ è¯å¡</button>
                    </div>
                    
                    <div class="file-input-wrapper">
                        <input type="file" id="image-upload" accept="image/*" multiple>
                        <button class="upload-btn" id="image-btn">ğŸ–¼ï¸ ä¸Šä¼ å›¾ç‰‡</button>
                    </div>
                    
                    <button class="upload-btn" id="start-btn" disabled>ğŸ® å¼€å§‹æ¸¸æˆ</button>
                    <button class="upload-btn" id="sample-btn">ğŸ² ä½¿ç”¨ç¤ºä¾‹æ•°æ®</button>
                </div>
                <p id="upload-status">è¯·å…ˆä¸Šä¼ è¯å¡å’Œå›¾ç‰‡ï¼Œæˆ–ç›´æ¥ç‚¹å‡»"ä½¿ç”¨ç¤ºä¾‹æ•°æ®"å¼€å§‹æ¸¸æˆ</p>
                
                <div id="upload-preview">
                    <div class="uploaded-items" id="uploaded-words"></div>
                    <div class="upload-preview" id="uploaded-images"></div>
                </div>
            </div>

            <div class="cards-container" id="cards-container">
                <!-- å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆæˆåŠŸæç¤º -->
    <div class="message" id="success-message">
        <div class="message-content">
            <h2>ğŸ‰ æ­å–œï¼ ğŸ‰</h2>
            <p>ä½ æˆåŠŸå®Œæˆäº†æ¸¸æˆï¼</p>
            <p>å¾—åˆ†: <span id="final-score">0</span></p>
            <p>ç”¨æ—¶: <span id="final-time">00:00</span></p>
            <button class="btn" id="restart-btn">ğŸ”„ å†æ¥ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€å˜é‡
        let gameState = {
            score: 0,
            time: 0,
            timer: null,
            selectedCard: null,
            matchedPairs: 0,
            totalPairs: 0,
            wordImagePairs: [],
            gameActive: false,
            uploadedWords: [],
            uploadedImages: []
        };

        // DOMå…ƒç´ 
        const cardsContainer = document.getElementById('cards-container');
        const timeElement = document.getElementById('time');
        const pointsElement = document.getElementById('points');
        const startBtn = document.getElementById('start-btn');
        const sampleBtn = document.getElementById('sample-btn');
        const excelBtn = document.getElementById('excel-btn');
        const imageBtn = document.getElementById('image-btn');
        const excelUpload = document.getElementById('excel-upload');
        const imageUpload = document.getElementById('image-upload');
        const uploadStatus = document.getElementById('upload-status');
        const uploadedWordsElement = document.getElementById('uploaded-words');
        const uploadedImagesElement = document.getElementById('uploaded-images');
        const successMessage = document.getElementById('success-message');
        const finalScoreElement = document.getElementById('final-score');
        const finalTimeElement = document.getElementById('final-time');
        const restartBtn = document.getElementById('restart-btn');

        // äº‹ä»¶ç›‘å¬å™¨
        excelBtn.addEventListener('click', () => excelUpload.click());
        imageBtn.addEventListener('click', () => imageUpload.click());
        excelUpload.addEventListener('change', handleExcelUpload);
        imageUpload.addEventListener('change', handleImageUpload);
        startBtn.addEventListener('click', startGame);
        sampleBtn.addEventListener('click', useSampleData);
        restartBtn.addEventListener('click', restartGame);

        // åˆ›å»ºèƒŒæ™¯æ°”æ³¡
        function createBubbles() {
            const bubblesCount = 15;
            for (let i = 0; i < bubblesCount; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                
                const size = Math.random() * 60 + 20;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                
                const colors = ['#ff9a9e', '#fad0c4', '#a1c4fd', '#c2e9fb', '#ffd166'];
                bubble.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                bubble.style.left = `${Math.random() * 100}%`;
                bubble.style.top = `${Math.random() * 100}%`;
                
                document.body.appendChild(bubble);
                
                // æ·»åŠ æµ®åŠ¨åŠ¨ç”»
                animateBubble(bubble);
            }
        }
        
        function animateBubble(bubble) {
            const duration = Math.random() * 20 + 10;
            const xMovement = Math.random() * 100 - 50;
            
            bubble.style.transition = `all ${duration}s linear`;
            bubble.style.transform = `translate(${xMovement}vw, -100vh)`;
            
            setTimeout(() => {
                bubble.style.transition = 'none';
                bubble.style.transform = 'translate(0, 100vh)';
                setTimeout(() => animateBubble(bubble), 100);
            }, duration * 1000);
        }

        // å¤„ç†è¯å¡ä¸Šä¼ 
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const words = parseWordFile(content, file.name);
                    
                    if (words.length > 0) {
                        gameState.uploadedWords = words;
                        updateUploadedItems();
                        uploadStatus.textContent = `âœ… å·²ä¸Šä¼ è¯å¡æ–‡ä»¶: ${file.name} (${words.length}ä¸ªè¯è¯­)`;
                        checkUploadStatus();
                    } else {
                        uploadStatus.textContent = `âŒ æ— æ³•ä»æ–‡ä»¶ ${file.name} ä¸­æå–è¯è¯­ï¼Œè¯·ä½¿ç”¨ç¤ºä¾‹æ•°æ®`;
                    }
                } catch (error) {
                    console.error("è§£ææ–‡ä»¶å‡ºé”™:", error);
                    uploadStatus.textContent = `âŒ è§£ææ–‡ä»¶å‡ºé”™: ${error.message}`;
                }
            };
            
            if (file.name.endsWith('.txt')) {
                reader.readAsText(file, 'UTF-8');
            } else {
                uploadStatus.textContent = `âŒ æ–‡ä»¶æ ¼å¼ ${file.name.split('.').pop()} æš‚ä¸æ”¯æŒï¼Œè¯·ä½¿ç”¨.txtæ–‡ä»¶æˆ–ç¤ºä¾‹æ•°æ®`;
            }
        }

        // è§£æè¯è¯­æ–‡ä»¶
        function parseWordFile(content, filename) {
            if (filename.endsWith('.txt')) {
                // æŒ‰è¡Œåˆ†å‰²ï¼Œè¿‡æ»¤ç©ºè¡Œ
                return content.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0)
                    .slice(0, 20); // æœ€å¤š20ä¸ªè¯
            }
            return [];
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            // é™åˆ¶æœ€å¤š20å¼ å›¾ç‰‡
            const fileCount = Math.min(files.length, 20);
            gameState.uploadedImages = [];
            
            for (let i = 0; i < fileCount; i++) {
                const file = files[i];
                const imageUrl = URL.createObjectURL(file);
                
                // ä»æ–‡ä»¶åæå–è¯è¯­ï¼ˆå»æ‰æ‰©å±•åï¼‰
                const wordFromFileName = file.name.replace(/\.[^/.]+$/, "");
                
                gameState.uploadedImages.push({
                    name: file.name,
                    url: imageUrl,
                    word: wordFromFileName
                });
            }
            
            updateUploadedItems();
            uploadStatus.textContent = `âœ… å·²ä¸Šä¼  ${fileCount} å¼ å›¾ç‰‡`;
            checkUploadStatus();
        }

        // æ›´æ–°å·²ä¸Šä¼ çš„é¡¹ç›®æ˜¾ç¤º
        function updateUploadedItems() {
            // æ›´æ–°å·²ä¸Šä¼ çš„è¯è¯­
            uploadedWordsElement.innerHTML = '';
            gameState.uploadedWords.forEach((word, index) => {
                const item = document.createElement('div');
                item.className = 'uploaded-item';
                item.textContent = `${index + 1}. ${word}`;
                uploadedWordsElement.appendChild(item);
            });
            
            // æ›´æ–°å·²ä¸Šä¼ çš„å›¾ç‰‡
            uploadedImagesElement.innerHTML = '';
            gameState.uploadedImages.forEach((image, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                const img = document.createElement('img');
                img.src = image.url;
                img.alt = image.name;
                
                previewItem.appendChild(img);
                uploadedImagesElement.appendChild(previewItem);
            });
        }

        // æ£€æŸ¥ä¸Šä¼ çŠ¶æ€
        function checkUploadStatus() {
            // å¦‚æœä¸Šä¼ äº†è¯å¡å’Œå›¾ç‰‡ï¼Œå¯ç”¨å¼€å§‹æŒ‰é’®
            if (gameState.uploadedWords.length > 0 && gameState.uploadedImages.length > 0) {
                startBtn.disabled = false;
                uploadStatus.textContent = 'âœ… ä¸Šä¼ å®Œæˆï¼ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹';
                
                // å¦‚æœè¯è¯­å’Œå›¾ç‰‡æ•°é‡ä¸åŒ¹é…ï¼Œç»™å‡ºæç¤º
                if (gameState.uploadedWords.length !== gameState.uploadedImages.length) {
                    uploadStatus.textContent += ` (æ³¨æ„: ${gameState.uploadedWords.length}ä¸ªè¯è¯­, ${gameState.uploadedImages.length}å¼ å›¾ç‰‡)`;
                }
            } else if (gameState.uploadedWords.length > 0 || gameState.uploadedImages.length > 0) {
                uploadStatus.textContent = 'ğŸ“ è¯·ç»§ç»­ä¸Šä¼ å‰©ä½™çš„æ–‡ä»¶';
            }
        }

        // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
        function useSampleData() {
            gameState.uploadedWords = ['è‹¹æœ', 'é¦™è•‰', 'æ©™å­', 'è¥¿ç“œ', 'è‰è“', 'è‘¡è„', 'è è', 'æ¡ƒå­', 'æ¢¨å­', 'æ¨±æ¡ƒ'];
            gameState.uploadedImages = [
                { name: 'è‹¹æœ.jpg', url: 'https://images.unsplash.com/photo-1568702846914-96b305d2aaeb?w=150&h=150&fit=crop', word: 'è‹¹æœ' },
                { name: 'é¦™è•‰.jpg', url: 'https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=150&h=150&fit=crop', word: 'é¦™è•‰' },
                { name: 'æ©™å­.jpg', url: 'https://images.unsplash.com/photo-1547514701-42782101795e?w=150&h=150&fit=crop', word: 'æ©™å­' },
                { name: 'è¥¿ç“œ.jpg', url: 'https://images.unsplash.com/photo-1589984662646-e7b2e4962f18?w=150&h=150&fit=crop', word: 'è¥¿ç“œ' },
                { name: 'è‰è“.jpg', url: 'https://images.unsplash.com/photo-1464454709131-ffd692591ee5?w=150&h=150&fit=crop', word: 'è‰è“' },
                { name: 'è‘¡è„.jpg', url: 'https://images.unsplash.com/photo-1591526037686-56e73ce7e0dc?w=150&h=150&fit=crop', word: 'è‘¡è„' },
                { name: 'è è.jpg', url: 'https://images.unsplash.com/photo-1550258987-190a2d41a8ba?w=150&h=150&fit=crop', word: 'è è' },
                { name: 'æ¡ƒå­.jpg', url: 'https://images.unsplash.com/photo-1571771316375-2c49cd200d6d?w=150&h=150&fit=crop', word: 'æ¡ƒå­' },
                { name: 'æ¢¨å­.jpg', url: 'https://images.unsplash.com/photo-1544318412-0e6c6f5b6812?w=150&h=150&fit=crop', word: 'æ¢¨å­' },
                { name: 'æ¨±æ¡ƒ.jpg', url: 'https://images.unsplash.com/photo-1528821156229-c6b47c2f7b13?w=150&h=150&fit=crop', word: 'æ¨±æ¡ƒ' }
            ];
            
            updateUploadedItems();
            uploadStatus.textContent = 'âœ… å·²åŠ è½½ç¤ºä¾‹æ•°æ®ï¼ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å¼€å§‹';
            startBtn.disabled = false;
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            // ç”Ÿæˆè¯å¡å’Œå›¾ç‰‡å¯¹
            generateWordImagePairs();
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initializeGame();
            
            // å¼€å§‹è®¡æ—¶
            startTimer();
            
            // ç¦ç”¨å¼€å§‹æŒ‰é’®
            startBtn.disabled = true;
            sampleBtn.disabled = true;
            gameState.gameActive = true;
            
            uploadStatus.textContent = 'ğŸ® æ¸¸æˆè¿›è¡Œä¸­...';
        }

        // ç”Ÿæˆè¯å¡å’Œå›¾ç‰‡å¯¹
        function generateWordImagePairs() {
            gameState.wordImagePairs = [];
            
            // æ ¹æ®å›¾ç‰‡æ–‡ä»¶åä¸­çš„è¯è¯­æ¥åŒ¹é…
            for (let i = 0; i < gameState.uploadedImages.length; i++) {
                const image = gameState.uploadedImages[i];
                const word = image.word;
                
                // æ£€æŸ¥è¿™ä¸ªè¯è¯­æ˜¯å¦åœ¨è¯å¡åˆ—è¡¨ä¸­
                if (gameState.uploadedWords.includes(word)) {
                    gameState.wordImagePairs.push({
                        word: word,
                        imageUrl: image.url
                    });
                }
            }
            
            gameState.totalPairs = gameState.wordImagePairs.length;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initializeGame() {
            // æ¸…ç©ºå¡ç‰‡å®¹å™¨
            cardsContainer.innerHTML = '';
            
            // åˆ›å»ºè¯å¡å’Œå›¾ç‰‡å¡
            const allCards = [];
            
            gameState.wordImagePairs.forEach(pair => {
                // è¯å¡
                const wordCard = document.createElement('div');
                wordCard.className = 'card word-card';
                wordCard.textContent = pair.word;
                wordCard.dataset.type = 'word';
                wordCard.dataset.value = pair.word;
                wordCard.addEventListener('click', () => handleCardClick(wordCard));
                
                // å›¾ç‰‡å¡
                const imageCard = document.createElement('div');
                imageCard.className = 'card image-card';
                imageCard.dataset.type = 'image';
                imageCard.dataset.value = pair.word;
                imageCard.addEventListener('click', () => handleCardClick(imageCard));
                
                const img = document.createElement('img');
                img.src = pair.imageUrl;
                img.alt = pair.word;
                
                const label = document.createElement('div');
                label.className = 'card-label';
                label.textContent = 'å›¾ç‰‡';
                
                imageCard.appendChild(img);
                imageCard.appendChild(label);
                
                allCards.push(wordCard, imageCard);
            });
            
            // æ´—ç‰Œ
            shuffleArray(allCards);
            
            // æ·»åŠ åˆ°å®¹å™¨
            allCards.forEach(card => cardsContainer.appendChild(card));
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.selectedCard = null;
            gameState.matchedPairs = 0;
            gameState.score = 0;
            updateScore();
        }

        // å¤„ç†å¡ç‰‡ç‚¹å‡»
        function handleCardClick(card) {
            if (!gameState.gameActive || card.classList.contains('matched') || card === gameState.selectedCard) {
                return;
            }
            
            // å¦‚æœå·²ç»é€‰ä¸­äº†ä¸€å¼ å¡ç‰‡
            if (gameState.selectedCard) {
                // æ£€æŸ¥æ˜¯å¦åŒ¹é…
                if (gameState.selectedCard.dataset.value === card.dataset.value && 
                    gameState.selectedCard.dataset.type !== card.dataset.type) {
                    // åŒ¹é…æˆåŠŸ
                    card.classList.add('matched');
                    gameState.selectedCard.classList.add('matched');
                    gameState.selectedCard = null;
                    
                    gameState.matchedPairs++;
                    gameState.score += 10;
                    updateScore();
                    
                    // æ’­æ”¾åŒ¹é…æˆåŠŸéŸ³æ•ˆ
                    playMatchSound();
                    
                    // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰åŒ¹é…
                    if (gameState.matchedPairs === gameState.totalPairs) {
                        levelComplete();
                    }
                } else {
                    // åŒ¹é…å¤±è´¥
                    card.classList.add('wrong');
                    gameState.selectedCard.classList.add('wrong');
                    
                    // æ’­æ”¾åŒ¹é…å¤±è´¥éŸ³æ•ˆ
                    playWrongSound();
                    
                    setTimeout(() => {
                        card.classList.remove('wrong', 'selected');
                        gameState.selectedCard.classList.remove('wrong', 'selected');
                        gameState.selectedCard = null;
                    }, 500);
                }
            } else {
                // é€‰ä¸­ç¬¬ä¸€å¼ å¡ç‰‡
                card.classList.add('selected');
                gameState.selectedCard = card;
            }
        }

        // æ’­æ”¾åŒ¹é…æˆåŠŸéŸ³æ•ˆ
        function playMatchSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 523.25; // C5
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // æ’­æ”¾åŒ¹é…å¤±è´¥éŸ³æ•ˆ
        function playWrongSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 220; // A3
            oscillator.type = 'sawtooth';
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
        function playVictorySound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // æ’­æ”¾ä¸€æ®µèƒœåˆ©æ—‹å¾‹
            const notes = [659.25, 783.99, 1046.50, 1318.51]; // E5, G5, C6, E6
            let time = audioContext.currentTime;
            
            oscillator.frequency.setValueAtTime(notes[0], time);
            oscillator.frequency.setValueAtTime(notes[1], time + 0.2);
            oscillator.frequency.setValueAtTime(notes[2], time + 0.4);
            oscillator.frequency.setValueAtTime(notes[3], time + 0.6);
            
            oscillator.type = 'triangle';
            
            gainNode.gain.setValueAtTime(0.4, time);
            gainNode.gain.exponentialRampToValueAtTime(0.01, time + 1);
            
            oscillator.start(time);
            oscillator.stop(time + 1);
        }

        // åˆ›å»ºåº†ç¥åŠ¨ç”»
        function createCelebration() {
            // åˆ›å»ºå½©è‰²çº¸å±‘
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                const colors = ['#ff6b6b', '#ffd166', '#06d6a0', '#118ab2', '#7209b7'];
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                confetti.style.left = `${Math.random() * 100}%`;
                
                document.body.appendChild(confetti);
                
                // çº¸å±‘åŠ¨ç”»
                const animation = confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 3000 + 2000,
                    easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
                });
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                animation.onfinish = () => {
                    confetti.remove();
                };
            }
        }

        // æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // å…³å¡å®Œæˆ
        function levelComplete() {
            clearInterval(gameState.timer);
            gameState.gameActive = false;
            
            // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
            playVictorySound();
            
            // åˆ›å»ºåº†ç¥åŠ¨ç”»
            createCelebration();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            finalScoreElement.textContent = gameState.score;
            finalTimeElement.textContent = timeElement.textContent;
            successMessage.style.display = 'flex';
            
            uploadStatus.textContent = 'ğŸ‰ æ­å–œï¼æ¸¸æˆå®Œæˆï¼';
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            successMessage.style.display = 'none';
            
            // é‡ç½®æ¸¸æˆ
            initializeGame();
            resetTimer();
            startTimer();
            
            // å¯ç”¨æŒ‰é’®
            startBtn.disabled = false;
            sampleBtn.disabled = false;
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            gameState.time = 0;
            updateTimer();
            
            gameState.timer = setInterval(() => {
                gameState.time++;
                updateTimer();
            }, 1000);
        }

        // é‡ç½®è®¡æ—¶å™¨
        function resetTimer() {
            clearInterval(gameState.timer);
            gameState.time = 0;
            updateTimer();
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            const minutes = Math.floor(gameState.time / 60);
            const seconds = gameState.time % 60;
            timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            pointsElement.textContent = gameState.score;
        }

        // åˆå§‹åŒ–
        function init() {
            createBubbles();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>